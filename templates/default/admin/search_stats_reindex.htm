<style type="text/css">@import url( ${contextPath}/templates/${templateName}/styles/style.css );</style>

<script type="text/javascript">
function writeOptions(fieldName, from, to) 
{
	document.write("<select name='" + fieldName + "' onChange='chooseByDate(this.form);'>");
	document.write("<option value=''>--</option>");

	for (var i = from; i <= to; i++) {
		document.write("<option value='" + i + "'>" + i + "</option>");
	}

	document.write("</select>&nbsp;&nbsp;");
}

function writeTimeGroup(fieldNamePrefix)
{
	document.write("<input type='text' style='width: 35px;' maxlength='2' name='" + fieldNamePrefix + "Hour'> : ");
	document.write("<input type='text' style='width: 35px;' maxlength='2' name='" + fieldNamePrefix + "Minutes'>");
}

function chooseByDate(f)
{
	f.firstPostId.value = "";
	f.lastPostId.value = "";
	f.type[0].checked = true;
}

function chooseByPostId(field)
{
	var value = field.value;
	
	if (value.length > 0) {
		if (isNaN(value * 1)) {
			alert("${I18n.getMessage("SearchStats.invalidPostId")}");
			field.value = "";
		}
		else {
			var f = field.form;

			f.fromDay.selectedIndex = 0;
			f.fromMonth.selectedIndex = 0;
			f.fromYear.selectedIndex = 0;
			f.fromHour.value = "";
			f.fromMinutes.value = "";

			f.toDay.selectedIndex = 0;
			f.toMonth.selectedIndex = 0;
			f.toYear.selectedIndex = 0;
			f.toHour.value = "";
			f.toMinutes.value = "";

			f.type[1].checked = true;
		}
	}
}
</script>

<table class="forumline gen" cellspacing="1" cellpadding="3" width="100%">
	<tr>
		<th class="thhead" colspan="5">${I18n.getMessage("SearchStats.ReIndex")}</th>
	</tr>

	<tr>
		<td>
			<strong>${I18n.getMessage("SearchStats.TotalMessagesInDatabase")}:</strong> <i>${totalMessages}</i>
		</td>
	</tr>

	<tr>
		<td>
			<strong>${I18n.getMessage("SearchStats.IndexLocation")}:</strong> <i>${indexLocation}</i>
		</td>
	</tr>

	<form action="${contextPath}/jforum${extension}">
	<input type="hidden" name="module" value="${moduleName}">
	<input type="hidden" name="action" value="reconstructIndexFromScratch">

	<tr>
		<td>
			<strong>${I18n.getMessage("SearchStats.IndexExists")}:</strong>
			<#if !indexExists>
				<i>${I18n.getMessage("No")}</i>. <a href="${contextPath}/jforum${extension}?module=${moduleName}&action=createIndexDirectory">>${I18n.getMessage("SearchStats.CreateIndexNow")}</a>
			<#else>
				<i>${I18n.getMessage("Yes")}</i>. 

			<table border="0" class="forumline gen">
				<tr>
					<th colspan="2">${I18n.getMessage("SearchStats.ReDo")}</th>
				</tr>

				<tr>
					<td>
						<input type="radio" id="reindexByDate" name="type" value="1" checked="checked"><label for="reindexByDate">${I18n.getMessage("SearchStats.ByDate")}</label>
					</td>
					<td valign="top">
						<table border="0" class="forumline gen">
							<tr>
								<td>${I18n.getMessage("SearchStats.From")}:</td>
								<td>
									<span class="gensmall">(dd/mm/yyyy hh:mm)</span>

									<script type="text/javascript">
										writeOptions("fromDay", 1, 31);
										writeOptions("fromMonth", 1, 12);
										writeOptions("fromYear", 1995, new Date().getFullYear());
										writeTimeGroup("from");
									</script>
								</td>
							</tr>

							<tr>
								<td>${I18n.getMessage("SearchStats.To")}:</td>
								<td>
									<span class="gensmall">(dd/mm/yyyy hh:mm)</span>

									<script type="text/javascript">
										writeOptions("toDay", 1, 31);
										writeOptions("toMonth", 1, 12);
										writeOptions("toYear", 1995, new Date().getFullYear());
										writeTimeGroup("to");
									</script>
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td>
						<input type="radio" id="reindexByMessage" name="type" value="2"><label for="reindexByMessage">${I18n.getMessage("SearchStats.ByMessageID")}</label>
					</td>
					<td valign="top">
						<table border="0" class="forumline gen">
							<tr>
								<td>${I18n.getMessage("SearchStats.From")}:</td>
								<td><input type="text" name="firstPostId" onBlur="chooseByPostId(this);">
							</tr>

							<tr>
								<td>${I18n.getMessage("SearchStats.To")}:</td>
								<td><input type="text" name="lastPostId" onBlur="chooseByPostId(this);">
							</tr>
						</table>
					</td>
				</tr>

				<tr>
					<td width="200">
						<input type="checkbox" id="avoidDuplicated" name="avoidDuplicatedRecords" value="yes" checked="checked"><label for="avoidDuplicates">${I18n.getMessage("SearchStats.CheckMessageExists")}</label>
					</td>
					<td class="gensmall">
						${I18n.getMessage("SearchStats.Warning")}
					</td>
				</tr>

				<tr>
					<td colspan="2" align="right" class="cat">
						<input type="submit" value="${I18n.getMessage("SearchStats.Start")}" style="width: 100px; font-weight: bold;">
					</td>
				</tr>
			</table>
			</#if>
		</td>
	</tr>

	</form>
</table>