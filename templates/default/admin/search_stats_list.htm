<style type="text/css">@import url( ${contextPath}/templates/${templateName}/styles/style.css );</style>

<script type="text/javascript" src="${contextPath}/dwr/interface/AjaxUtils.js?${startupTime}"></script>
<script type="text/javascript" src="${contextPath}/dwr/engine.js?${startupTime}"></script>

<script type="text/javascript">
function writeOptions(fieldName, from, to) 
{
	document.write("<select name='" + fieldName + "' onChange='chooseByDate(this.form);'>");
	document.write("<option value=''>--</option>");

	for (var i = from; i <= to; i++) {
		document.write("<option value='" + i + "'>" + i + "</option>");
	}

	document.write("</select>&nbsp;&nbsp;");
}

function writeTimeGroup(fieldNamePrefix)
{
	document.write("<input type='text' style='width: 35px;' maxlength='2' name='" + fieldNamePrefix + "Hour'> : ");
	document.write("<input type='text' style='width: 35px;' maxlength='2' name='" + fieldNamePrefix + "Minutes'>");
}

function chooseByDate(f)
{
	f.firstPostId.value = "";
	f.lastPostId.value = "";
	f.type[0].checked = true;
}

function chooseByPostId(field)
{
	var value = field.value;
	
	if (value.length > 0) {
		if (isNaN(value * 1)) {
			alert("${I18n.getMessage("SearchStats.invalidPostId")}");
			field.value = "";
		}
		else {
			var f = field.form;

			f.fromDay.selectedIndex = 0;
			f.fromMonth.selectedIndex = 0;
			f.fromYear.selectedIndex = 0;
			f.fromHour.value = "";
			f.fromMinutes.value = "";

			f.toDay.selectedIndex = 0;
			f.toMonth.selectedIndex = 0;
			f.toYear.selectedIndex = 0;
			f.toHour.value = "";
			f.toMinutes.value = "";

			f.type[1].checked = true;
		}
	}
}

function checkIfPostExists()
{
	var postId = document.getElementById("checkPostId").value;

	if (!isNaN(postId * 1)) {
		AjaxUtils.isPostIndexed(postId, checkIfPostExistsCallback);
	}
}

function checkIfPostExistsCallback(status)
{
	if (status) {
		alert("${I18n.getMessage("Yes")}");
	}
	else {
		alert("${I18n.getMessage("No")}");
	}
}
</script>

<table border="0" class="forumline gen" width="100%">
	<tr>
		<th colspan="2">${I18n.getMessage("SearchStats.Title")}</th>
	</tr>

	<tr>
		<td width="200"><strong>${I18n.getMessage("SearchStats.TotalMessagesInDatabase")}:</strong> </td>
		<td><i>${totalMessages}</i></td>
	</tr>

	<tr>
		<td class="row3"><strong>${I18n.getMessage("SearchStats.IndexLocation")}:</strong></td>
		<td class="row3"><i>${indexLocation}</i></td>
	</tr>

	<tr>
		<td><strong>${I18n.getMessage("SearchStats.IndexExists")}:</strong></td>
		<td>
			<#if !indexExists>
				<i>${I18n.getMessage("No")}</i>. <a href="${contextPath}/jforum${extension}?module=${moduleName}&action=createIndexDirectory">>${I18n.getMessage("SearchStats.CreateIndexNow")}</a>
			<#else>
				<i>${I18n.getMessage("Yes")}</i>. 
			</#if>
		</td>
	</tr>

	<#if indexExists>
		<tr>
			<td class="row3"><strong>Last modification date:</strong></td>
			<td class="row3"><i>${lastModified?datetime}</i></td>
		</tr>

		<tr>
			<td><strong>Number of documents:</strong> </td>
			<td><i>${numberOfDocs}</i></td>
		</tr>

		<tr>
			<td class="row3"><strong>Index version:</strong> </td>
			<td class="row3"><i>${indexVersion}</i></td>
		</tr>

		<tr>
			<td><strong>Is locked? (write.lock)</strong> </td>
			<td>
				<i>
					<#if isLocked>
						${I18n.getMessage("Yes")}
					<#else>
						${I18n.getMessage("No")}
					</#if>
				</i>
			</td>
		</tr>

		<tr>
			<td class="row3"><strong>${I18n.getMessage("SearchStats.isPostIndexed")}</strong> </td>
			<td class="gensmall row3">
				${I18n.getMessage("SearchStats.enterPostId")}: 
				<input type="text" id="checkPostId">
				<input type="button" value="${I18n.getMessage("SearchStats.check")}" onClick="checkIfPostExists();">
			</td>
		</tr>
	</#if>
</table>

<br/>

<#if indexExists>
	<form action="${contextPath}/jforum${extension}">
	<input type="hidden" name="module" value="${moduleName}">
	<input type="hidden" name="action" value="reconstructIndexFromScratch">

	<table border="0" class="forumline gen" width="100%">
		<tr>
			<th colspan="2">${I18n.getMessage("SearchStats.ReDo")}</th>
		</tr>

		<tr>
			<td>
				<input type="radio" id="reindexByDate" name="type" value="1" checked="checked"><label for="reindexByDate">${I18n.getMessage("SearchStats.ByDate")}</label>
			</td>
			<td valign="top">
				<table border="0" class="gen">
					<tr>
						<td>${I18n.getMessage("SearchStats.From")}:</td>
						<td>
							<span class="gensmall">(dd/mm/yyyy hh:mm)</span>

							<script type="text/javascript">
								writeOptions("fromDay", 1, 31);
								writeOptions("fromMonth", 1, 12);
								writeOptions("fromYear", 1995, new Date().getFullYear());
								writeTimeGroup("from");
							</script>
						</td>
					</tr>

					<tr>
						<td>${I18n.getMessage("SearchStats.To")}:</td>
						<td>
							<span class="gensmall">(dd/mm/yyyy hh:mm)</span>

							<script type="text/javascript">
								writeOptions("toDay", 1, 31);
								writeOptions("toMonth", 1, 12);
								writeOptions("toYear", 1995, new Date().getFullYear());
								writeTimeGroup("to");
							</script>
						</td>
					</tr>
				</table>
			</td>
		</tr>

		<tr>
			<td class="row3">
				<input type="radio" id="reindexByMessage" name="type" value="2"><label for="reindexByMessage">${I18n.getMessage("SearchStats.ByMessageID")}</label>
			</td>
			<td valign="top" class="row3">
				<table border="0" class="gen">
					<tr>
						<td>${I18n.getMessage("SearchStats.From")}:</td>
						<td><input type="text" name="firstPostId" onBlur="chooseByPostId(this);">
					</tr>

					<tr>
						<td>${I18n.getMessage("SearchStats.To")}:</td>
						<td><input type="text" name="lastPostId" onBlur="chooseByPostId(this);">
					</tr>
				</table>
			</td>
		</tr>

		<tr>
			<td width="200">
				<input type="checkbox" id="avoidDuplicated" name="avoidDuplicatedRecords" value="yes" checked="checked"><label for="avoidDuplicates">${I18n.getMessage("SearchStats.CheckMessageExists")}</label>
			</td>
			<td class="gensmall">
				${I18n.getMessage("SearchStats.Warning")}
			</td>
		</tr>

		<tr>
			<td colspan="2" align="right" class="cat">
				<input type="submit" value="${I18n.getMessage("SearchStats.Start")}" style="width: 100px; font-weight: bold;">
			</td>
		</tr>
	</table>
	</form>
</#if>
