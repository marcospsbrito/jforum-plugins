<#import "../macros/pagination.ftl" as pagination/>
<#import "../macros/utils.ftl" as utils/>

<script language="JavaScript">
function confirmDelete()
{
	if (confirm("${I18n.getMessage("Moderation.ConfirmPostDelete")}")) {
		return true;
	}
	
	return false;
}
</script>

<table cellspacing="0" cellpadding="10" width="100%" align="center" border="0">
	<tr>
		<td class="bodyline">
			<table cellspacing="2" cellpadding="2" width="100%" border="0">
				<tr>
					<td valign="middle" align="left" colspan="2">
						<span class="maintitle"><a href="${contextPath}/posts/list/${topic.id}${extension}" name="top" class="maintitle" id="top">${topic.title?html}</a></span>
					</td>
				</tr>
			</table>
			
			<table cellspacing="2" cellpadding="2" width="100%" border="0">
				<tr>
					<#if !readonly>
					<td width="15%" align="left" valign="bottom" nowrap="nowrap">
					</#if>
						<#if topic.status == STATUS_LOCKED>
							<img src="${contextPath}/templates/${templateName}/images/reply_locked.gif" />
						<#else>
							<#if !readonly>
								<span class="nav">&nbsp;
								<a href="${contextPath}/jforum${extension}?module=posts&amp;action=insert&amp;forum_id=${topic.forumId}"><img src="${contextPath}/templates/${templateName}/images/post.gif" width="82" height="25" border="0" /></a>
								<a href="${contextPath}/jforum${extension}?module=posts&amp;action=insert&amp;topic_id=${topic.id}&amp;forum_id=${topic.forumId}&start=${thisPage}"><img src="${contextPath}/templates/${templateName}/images/reply.gif" width="82" height="25" border="0" /></a>
								</span>
							<#else>
								<#assign colspan = "2"/>
							</#if>
						</#if>
					</td>

					<td valign="center" align="left" colspan="${colspan?default("0")}">
						<span class="nav">&nbsp;&nbsp;&nbsp;
						<a class="nav" href="${contextPath}/forums/list${extension}">${I18n.getMessage("ForumListing.forumIndex")} </a> 
            			-&gt; <a class="nav" href="${contextPath}/forums/show/${forum.id}${extension}">${forum.name} </a>
						</span>
					</td>
					
					<#if logged?default(false)>
					<td align="left" valign="middle">
						<span class="nav">
						<#assign watch = "watch"/>
						<#assign watchMessage = I18n.getMessage("PostShow.watch")/>
						<#if watching>
							<#assign watch = "unwatch"/>
							<#assign watchMessage = I18n.getMessage("PostShow.unwatch")/>
						</#if>
						
						<a href="${contextPath}/posts/${watch}/${thisPage}/${topicId}${extension}"><img src="${contextPath}/templates/${templateName}/images/watch.gif" align="top" border="0"></a>
						<a href="${contextPath}/posts/${watch}/${thisPage}/${topicId}${extension}">${watchMessage}</a>
						</span>
					</td>
					</#if>

					<td valign="middle" align="right">
						<@pagination.doPagination "list", topicId/>
					</td>
			
				</tr>
			</table>

			<table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0">
				<tr>
					<th class="thLeft" nowrap="nowrap" width="103" height="26">${I18n.getMessage("PostShow.author")}</th>
					<th class="thRight" nowrap="nowrap">${I18n.getMessage("PostShow.messageTitle")}</th>
				</tr>

			<!-- POSTS --> 
			<#assign rowColor = ""/>
			<#list posts as post>
				<#if post_index % 2 == 0>
					<#assign rowColor = "row1">
				<#else>
					<#assign rowColor = "row2">
				</#if>
	
				<#assign user = users.get(post.userId)/>
				<tr>
					<td width="150" class="${rowColor}" valign="top" align="left">
					
						<span class="name"><b>${user.username}</b></span>
						<br />
						
						<span class="postdetails">
						<#if post.userId != 1>
							${rank.getRankTitle(user.totalPosts)}
							<br />
						</#if>

						<#if (user.avatar?exists && user.avatar?length > 0)>
							<img src="${contextPath}/images/avatar/${user.avatar}" border="0" />
						</#if>
						<br /> 
						
						<#if post.userId != 1>
							${I18n.getMessage("PostShow.userTotalMessages")}: ${user.totalPosts}
						</#if>
						<br />
						
						<#if user.from?exists>
							${I18n.getMessage("PostShow.userFrom")}: ${user.from}
							<br />
						</#if>

						<#if post.userIp?exists && isModerator>
							${I18n.getMessage("PostShow.userIP")}: ${post.userIp}
							<br />
						</#if>
						</span>
						<br />
					</td>
	
					<td class="${rowColor}" valign="top" height="28" width="100%">
						<table cellspacing="0" cellpadding="0" width="100%" border="0">
							<tr>
								<td width="80%">
									<span class="postdetails">
									<img src="${contextPath}/templates/${templateName}/images/icon_minipost.gif" width="12" height="9" />${post.formatedTime}<span class="gen">&nbsp;</span>&nbsp; &nbsp;${I18n.getMessage("PostShow.subject")}: <a name="${post.id}" id="${post.id}">${post.subject?html}</a>
									</span>
								</td>
								
								<td valign="top" width="20%" nowrap="nowrap" align="right">
								<#if topic.status != STATUS_LOCKED>
									<a href="${contextPath}/jforum${extension}?module=${moduleName}&amp;action=quote&amp;post_id=${post.id}&start=${thisPage}"><img src="${contextPath}/templates/${templateName}/images/icon_quote.gif" width="59" height="18" border="0" /></a>
								</#if>

								<#if ((post.canEdit && topic.status != STATUS_LOCKED) || canEdit)>
									<a href="${contextPath}/jforum${extension}?module=${moduleName}&amp;action=edit&amp;post_id=${post.id}&start=${thisPage}"><img src="${contextPath}/templates/${templateName}/images/icon_edit.gif" width="59" height="18" border="0" /></a>  
								</#if>
		
								<#if canRemove>
									<a href="${contextPath}/jforum${extension}?module=${moduleName}&amp;action=delete&amp;post_id=${post.id}&start=${thisPage}" onClick="return confirmDelete();"><img src="${contextPath}/templates/${templateName}/images/icon_delete.gif" width="16" height="18" border="0" /></a>  
								</#if>
								</td>
							</tr>
							
							<tr>
								<td colspan="2">
									<hr />
								</td>
							</tr>

							<tr>
								<td colspan="2" valign="top">
									<span class="postbody">
									${post.text?replace("<script", "&lt;script")}
									
									<#if (user.attachSignatureEnabled && user.signature?exists &user.signature?length > 0)>
									<hr />
									${user.signature?replace("<script", "&lt;script")}
									</#if>
									</span>
								</td>
							</tr>
						</table>
					</td>
				</tr>
	
				<tr>
					<td class="${rowColor}" valign="center" align="left" width="103">
						<span class="nav"><a class="nav" href="#top">${I18n.getMessage("PostShow.top")}</a></span>
					</td>
					
					<td class="${rowColor}" valign="top" nowrap="nowrap" height="28">
						<table height="18" cellspacing="0" cellpadding="0" width="469" border="0">
							<tr>
								<td valign="center" nowrap="nowrap"> 
									<a href="${contextPath}/user/profile/${user.id}${extension}"><img src="${contextPath}/templates/${templateName}/images/icon_profile.gif" width="59" height="18" border="0" /></a>

									<#if (user.isViewEmailEnabled() && user.email?exists && user.email?length > 0)>
										<@utils.convertEmail user.email/>
									</#if>
									
									<#if (user.webSite?exists && user.webSite?length > 0)>
										<a href="${user.webSite}" target="_new"><img src="${contextPath}/templates/${templateName}/images/icon_www.gif" width="59" height="18" border="0" /></a>
									</#if>
									
									<#if (user.yim?exists && user.yim?length > 0)>
										<a href="http://edit.yahoo.com/config/send_webmesg?.target=${user.yim}&amp;.src=pg"><img src="${contextPath}/templates/${templateName}/images/icon_yim.gif" width="59" height="18" border="0" /></a>
									</#if>
									
									<#if (user.msnm?exists && user.msnm?length > 0)>
										<a href="${contextPath}/user/profile/${user.id}${extension}"><img src="${contextPath}/templates/${templateName}/images/icon_msnm.gif" width="59" height="18" border="0" /></a>
									</#if>
									
									<#if (user.icq?exists && user.icq?length > 0)>
										<a href="http://wwp.icq.com/scripts/search.dll?to=${user.icq}"><img src="${contextPath}/templates/${templateName}/images/icon_icq_add.gif" border="0" /></a>
									</#if>
								</td>
							</tr>
						</table>
					</td>
				</tr>
	
				<tr>
					<td class="spaceRow" colspan="2" height="1"><img src="${contextPath}/templates/${templateName}/images/spacer.gif" alt="" width="1" height="1" /></td>
				</tr>
			</#list>
			
			<tr align="center">
				<td class="catBottom" colspan="2" height="28">
					<table cellspacing="0" cellpadding="0" border="0">
						<tr>
							<td align="center"><span class="gensmall">&nbsp;</span></td>
						</tr>
					</table>
				</td>
			</tr>			  
			<!-- END OF POSTS -->			  
			</table>
		
			<table cellspacing="2" cellpadding="2" width="100%" align="center" border="0">
				<tr>
					<#if !readonly>
					<td width="15%" align="left" valign="bottom" nowrap="nowrap">
					</#if>
					<#if topic.status == STATUS_LOCKED>
						<img src="${contextPath}/templates/${templateName}/images/reply_locked.gif" />
					<#else>
						<#if !readonly>
							<span class="nav">
							&nbsp;<a href="${contextPath}/jforum${extension}?module=posts&amp;action=insert&amp;forum_id=${topic.forumId}"><img src="${contextPath}/templates/${templateName}/images/post.gif" width="82" height="25" border="0" /></a>
							&nbsp;<a href="${contextPath}/jforum${extension}?module=posts&amp;action=insert&amp;topic_id=${topic.id}&amp;forum_id=${topic.forumId}&start=${thisPage}"><img src="${contextPath}/templates/${templateName}/images/reply.gif" width="82" height="25" border="0" /></a>
							</span>
						<#else>
							<#assign colspan = "2"/>
						</#if>
		  			</#if>
					</td>
					
					<td valign="center" align="left" colspan="${colspan?default("0")}">
						<span class="nav">&nbsp;&nbsp;&nbsp;
						<a class="nav" href="${contextPath}/forums/list${extension}">${I18n.getMessage("ForumListing.forumIndex")} </a> 
            			-&gt; <a class="nav" href="${contextPath}/forums/show/${forum.id}${extension}">${forum.name} </a>
						</span>
					</td>

					<td valign="middle" align="right">
						<@pagination.doPagination "list", topicId/>
					</td>
				</tr>
				
				<tr>
					<td colspan="3"><img src="${contextPath}/templates/${templateName}/images/spacer.gif" alt="" width="1" height="1" /></td>
				</tr>
				
				<!--
		        <tr>
					<td align="left" colspan="3">
					<span class="gensmall">
					<a href="${contextPath}/posts/unwatch/${topic.id}${extension}">${I18n.getMessage("PostShow.unwatch")}</a>
					</span>
					</td>
				</tr>
				
				<tr>
					<td colspan="3"><img src="${contextPath}/templates/${templateName}/images/spacer.gif" alt="" width="1" height="1" /></td>
				</tr>
				
				<tr>
					<td align="left" colspan="2">
					<img src="${contextPath}/templates/${templateName}/images/topic_delete.gif" border="0"/>
					<img src="${contextPath}/templates/${templateName}/images/topic_move.gif" border="0"/>
					<img src="${contextPath}/templates/${templateName}/images/topic_lock.gif" border="0"/>
					</td>
					<td align="right">eee</td>
				</tr>
				-->
			</table>
		</td>
	</tr>
</table>
